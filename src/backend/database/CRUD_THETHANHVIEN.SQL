USE QLY_NHAHANG
GO

CREATE PROCEDURE THETHANHVIEN_Insert
    @MaThe CHAR(8),
    @NgayLap DATE NOT NULL,
    @LoaiThe NVARCHAR(50) NOT NULL,
    @DiemTichLuy INT NOT NULL,
    @IsActive BIT NOT NULL,
    @MaKH INT NOT NULL,
    @MaNV INT NOT NULL
AS
BEGIN
    INSERT INTO THETHANHVIEN
    VALUES (@MaThe, @NgayLap, @LoaiThe, ISNULL(@DiemTichLuy, 0), @IsActive, @MaKH, @MaNV)
END;
GO

CREATE PROCEDURE THETHANHVIEN_Update
    @MaThe CHAR(8),
    @NgayLap DATE NOT NULL,
    @LoaiThe NVARCHAR(50) NOT NULL,
    @DiemTichLuy INT NOT NULL,
    @IsActive BIT NOT NULL,
    @MaKH INT NOT NULL,
    @MaNV INT NOT NULL
AS
BEGIN
    UPDATE THETHANHVIEN
    SET NgayLap = @NgayLap, LoaiThe = @LoaiThe, DiemTichLuy = @DiemTichLuy, IsActive = @IsActive, MaKH = @MaKH, MaNV = @MaNV
    WHERE MaThe = @MaThe;
END;
GO

CREATE PROCEDURE THETHANHVIEN_Delete
    @MaThe CHAR(8)
AS
BEGIN
    DELETE FROM THETHANHVIEN
    WHERE MaThe = @MaThe;
END;
GO

CREATE PROCEDURE THETHANHVIEN_GetAll
AS
BEGIN
    SELECT * FROM THETHANHVIEN;
END;
GO

CREATE PROCEDURE THETHANHVIEN_GetByMaThe
    @MaThe CHAR(8)
AS
BEGIN
    SELECT * FROM THETHANHVIEN
    WHERE MaThe = @MaThe;
END;
GO

CREATE PROCEDURE THETHANHVIEN_GetByMaKH
    @MaKH INT
AS
BEGIN
    SELECT * FROM THETHANHVIEN
    WHERE MaKH = @MaKH;
END;
GO

CREATE PROCEDURE THETHANHVIEN_GetByMaNV
    @MaNV INT
AS
BEGIN
    SELECT * FROM THETHANHVIEN
    WHERE MaNV = @MaNV;
END;
GO

CREATE PROCEDURE THETHANHVIEN_GetByLoaiThe
    @LoaiThe NVARCHAR(50)
AS
BEGIN
    SELECT * FROM THETHANHVIEN
    WHERE LoaiThe = @LoaiThe;
END;
GO

CREATE PROCEDURE THETHANHVIEN_GetByDiemTichLuy
    @DiemTichLuy INT
AS
BEGIN
    SELECT * FROM THETHANHVIEN
    WHERE DiemTichLuy = @DiemTichLuy;
END;
GO

CREATE PROCEDURE THETHANHVIEN_GetByIsActive
    @IsActive BIT
AS
BEGIN
    SELECT * FROM THETHANHVIEN
    WHERE IsActive = @IsActive;
END;
GO

CREATE PROCEDURE THETHANHVIEN_CapLaiTheMoi
    @MaKH INT,
    @MaTheMoi CHAR(8),
    @MaNV INT
AS
BEGIN
    UPDATE THETHANHVIEN
    SET IsActive = 0
    WHERE MAKH = @MaKH AND IsActive = 1;

    INSERT INTO THETHANHVIEN
    SELECT @MaTheMoi, GETDATE(), LoaiThe, DiemTichLuy, 1, @MaKH, @MaNV
    FROM THETHANHVIEN
    WHERE MaThe = @MaThe AND NgayLap = (SELECT MAX(NgayLap) FROM THETHANHVIEN WHERE MaKH = @MaKH);
END;
GO

